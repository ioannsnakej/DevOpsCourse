<h2>Цель: Изучение и практическое применение Jenkins pipeline, применение
Groovy и работа с DSL job.</h2>
<h3>Задание:</h3>
<ol>
  <li>Создайте новый Jenkins Pipeline, используя декларативный синтаксис.</li>
  <li>Определите агента для вашего Pipeline, который будет выполнять вашу
  сборку, тестирование и развертывание.</li>
  <li>Добавьте несколько этапов (stages) в ваш Pipeline, таких как "Build"
  (сборка), "Test" (тестирование) и "Deploy" (развертывание).</li>
  <li>В каждом этапе определите шаги (steps), которые должны быть
  выполнены, используя соответствующие Jenkins-плагины или команды,
  такие как sh для выполнения Shell-скриптов или git для работы с
  репозиторием Git.</li>
  <li>Добавьте условия выполнения (when) для определенных этапов на
  основе веток, изменений или других параметров, используя синтаксис
  Groovy и объект params.</li>
  <li>Добавьте использование параметров (parameters) в вашем Pipeline,
  таких как окружение (environment) или другие настраиваемые значения,
  и используйте их в шагах вашего Pipeline.</li>
  <li>Добавьте обработку ошибок (error handling) в ваш Pipeline, такую как
  проверка статуса выполнения шагов и обработка ошибок в случае
  возникновения проблем.</li>
  <li>Проверьте работу вашего Pipeline, запустив его на Jenkins и отслеживая
  выполнение этапов и шагов в интерфейсе Jenkins.</li>
  <li>Документируйте ваш Pipeline, описав его структуру, шаги, условия
  выполнения и параметры в документе или файле README.</li>
  <li>Напишите Groovy-скрипт, который автоматизирует процесс сборки и
  развертывания веб-приложения с использованием инструментов Jenkins
  и Docker. Требования:</li>
    <ol>
    <li type='a'>Скрипт должен быть написан на Groovy и запускаться в
    окружении Jenkins.</li>
    <li type='a'>Скрипт должен выполнять следующие шаги: Клонирование
    репозитория с веб-приложением из Git.</li>
    <li type='a'>Сборка приложения с помощью Gradle или Maven. Создание
    Docker-образа приложения.</li>
    <li type='a'>Запуск Docker-контейнера с созданным образом на сервере.
    Проверка доступности веб-приложения после развертывания.</li>
    <li type='a'>Скрипт должен обрабатывать ошибки и выводить
    соответствующие сообщения в случае возникновения проблем.</li>
    </ol>
  <li>Дополнительное задание (необязательное): Расширьте скрипт
  функциональностью удаления предыдущей версии Docker-контейнера
  перед развертыванием новой версии.</li>
  <li>Создание и выполнение задания на автоматическую генерацию отчета.
  Описание: Вы работаете в компании, занимающейся анализом данных,
  и вам необходимо автоматизировать процесс генерации отчетов на
  основе данных, хранящихся в базе данных. Для этого вы должны
  создать и выполнить задание на использование DSL для генерации
  отчета. Требования:</li>
    <ol>
    <li type='a'>Создайте DSL на одном из языков программирования (например,
    Python, Ruby, SQL), который позволит описать параметры отчета,
    такие как тип отчета, период, фильтры и другие необходимые
    настройки.</li>
    <li type='a'>Используя созданный DSL, создайте задание на генерацию
    отчета, указав необходимые параметры отчета.</li>
    <li type='a'>Выполните созданное задание и получите результаты генерации
    отчета.</li>
    <li type='a'>Обработайте результаты выполнения задания, например,
    выведите на экран информацию о сгенерированном отчете или
    сохраните его в файл.</li>
    <li type='a'>Добавьте обработку возможных ошибок, таких как отсутствие
    данных в базе данных или неправильные параметры отчета.</li>
    </ol>
</ol>

Подключаем jenkins агнета:
<ol>
<li>
  Запускаем в virtual-box нашу ВМ-агента в фоновом режиме:
  
  ![notify](/lesson_30/screenshots/start_vm.png)
</li>
<li>
  Выполняем на основном хосте наш playbook по настройке jenkins-agent из <a href="https://github.com/ioannsnakej/DevOpsCourse/blob/main/lesson_20/homework2.md">lesson_20</a> 
</li>
<li>
  На нашем master открываем в браузере jenkins (http://localhost:8080/)

  Переходим в "Настроить Jenkins"->"Nodes"->"New Node"

   ![notify](/lesson_30/screenshots/new-node.png)

   ![notify](/lesson_30/screenshots/new-node1.png)

   ![notify](/lesson_30/screenshots/new-node2.png)

>[!NOTE]
>Количество процессов-исполнителей: "2" = количеству числа ядер<br>
>Удалённая корневая директория: "/home/jenkins" - удаленная корневая директория jenkins
>Метки: "docker"<br>
>Использование: "Собирать только проекты с метками, совпадающими с этим узлом" - чтобы Jenkins не насовал чужих задач<br>
>Способ запуска: "Launch agents via SSH", Host: 192.168.56.5, Credentials: "git (github_ssh)" (вообще это приватный ключ jenkins из /var/lib/jenkins/.ssh/id_ed25519)<br>
>Host Key Verification Strategy: "Non verifying Verification Strategy"
</li>

  
