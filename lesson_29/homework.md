<h2>–¶–µ–ª—å: –ò–∑—É—á–µ–Ω–∏–µ –æ—Å–Ω–æ–≤ DevOps, –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ Python –≤ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
–ø—Ä–æ—Ü–µ—Å—Å–æ–≤ DevOps, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫ Python –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
–¥–∞–Ω–Ω—ã—Ö, –∞ —Ç–∞–∫–∂–µ –∏–∑—É—á–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ CI/CD –∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤,
–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã—Ö –≤ —ç—Ç–æ–º –ø—Ä–æ—Ü–µ—Å—Å–µ.</h2>
–ó–∞–¥–∞–Ω–∏–µ:
<ol>
<li>–°–æ–∑–¥–∞–π—Ç–µ —É—á–µ—Ç–Ω—É—é –∑–∞–ø–∏—Å—å –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é –º–µ–∂–¥—É –≤—ã–±—Ä–∞–Ω–Ω—ã–º
–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–º —á–∞—Ç–∞ –∏ —Å–∏—Å—Ç–µ–º–æ–π –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, GitLab –∏–ª–∏
GitHub).</li>
<li>–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–æ—Å—Ç–æ–π –ø–∞–π–ø–ª–∞–π–Ω CI/CD —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ
–∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —á–∞—Ç–æ–º. –ù–∞–ø—Ä–∏–º–µ—Ä,
–Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è –æ —Å–±–æ—è—Ö —Å–±–æ—Ä–æ–∫ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ
–≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ —Å–±–æ—è.</li>
<li>–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ChatOps –≤ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–Ω–æ–º –∫–æ–¥–µ —Å
–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ —Ç–∞–∫–æ–≥–æ –∫–∞–∫ Terraform, –Ω–∞–ø—Ä–∏–º–µ—Ä,
–Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è –æ —Å–æ–∑–¥–∞–Ω–∏–∏/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Ä–µ—Å—É—Ä—Å–æ–≤
–∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –≤ —á–∞—Ç–µ.</li>
<li>–°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è ChatOps –≤ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
—Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ —Ç–∞–∫–æ–≥–æ –∫–∞–∫
Ansible, –Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏—è –æ —É—Å–ø–µ—à–Ω–æ–º —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–∏
–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ —á–∞—Ç–µ.</li>
<li>–ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –≤–∞—à—É –Ω–∞—Å—Ç—Ä–æ–π–∫—É ChatOps –Ω–∞ –ø—Ä–∞–∫—Ç–∏–∫–µ, –ø–æ–∫–∞–∑–∞–≤
—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –≤ —á–∞—Ç–µ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è, –≤—ã–ø–æ–ª–Ω—è–µ–º—ã–µ
–Ω–∞ –æ—Å–Ω–æ–≤–µ –æ–ø–æ–≤–µ—â–µ–Ω–∏–π.</li>
</ol>

<h3>–í—ã–±–æ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è</h3>
–ó–∞ –æ—Å–Ω–æ–≤—É –±–µ—Ä—É –ø—Ä–æ–µ–∫—Ç –∏–∑ –¥–æ–º–∞—à–∫–∏ –ø–æ docker compose - https://github.com/ioannsnakej/bookstore/tree/main
<h3>–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Jenkins</h3>
–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é Java –∏ Jenkins –ø–æ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ - https://www.jenkins.io/doc/book/installing/linux/#debianubuntu
<h3>–ù–∞–ø–∏—Å–∞–Ω–∏–µ Jenkinsfile</h3>
–ù–∞ —Å–≤–æ–µ–π –í–ú:

    cd bookstore
    vim Jenkinsfile
–ü–∏—à–µ–º –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ Jenkinsfile:

    pipeline {
      agent any
      parameters {
        booleanParam(name: 'RUN_TEST', defaultValue: 'true') 
        string(name: 'TAG', defaultValue: 'latest')
        gitParameter(type: 'PT-BRANCH', name: 'REVISION', branchFilter: 'origin/(.*)', defaultValue: 'main', selectedValue: 'DEFAULT')
      }
    
      environment {
        GIT_NAME="ivankhodyrev"
        PRJ_NAME="bookstore"
        GIT_URL="https://github.com/ioannsnakej/bookstore.git"
        TOKEN=credentials('docker_token')
      }
    
      stages {
        stage('Clone repo') {
          steps {
            script {
              sh """
                if [ -d ${env.PRJ_NAME}/.git ]; then
                  echo "Repo exists. Updating..."
                  cd ${env.PRJ_NAME}
                  git checkout ${params.REVISION}
                  git pull
                else
                  echo "Clone repo"
                  git clone ${env.GIT_URL}
                fi
              """
            }
          }
        }
    
        stage('Build image') {
          steps {
            script {
              sh """
                cd ${env.PRJ_NAME}
                docker build -t ${env.GIT_NAME}/${env.PRJ_NAME}:${params.TAG} .
                docker login -u ${env.GIT_NAME} -p ${env.TOKEN}
                docker push ${env.GIT_NAME}/${env.PRJ_NAME}:${params.TAG}
                docker logout
              """
            }
          }
        }
    
        stage('Run test') {
          when {
            expression { params.RUN_TESTS }
          }
          steps {
            script {
              sh """
                cd ${ennv.PRJ_NAME}
                echo "App ready"
              """
            }
          }
        }
      }
        
    }
***
    git status
    git add .
    git commit -m "Add Jenkinsfile"
    git push origin main
<h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ª–∏—á–Ω–æ–≥–æ Docker Hub</h3>
–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ–º—Å—è –Ω–∞ dockerhub - https://hub.docker.com/

–î–æ–±–∞–≤–ª—è–µ–º –¢–û–ö–ï–ù jenkins-pipeline - https://app.docker.com/accounts/ivankhodyrev/settings/personal-access-tokens 

–ö–æ–ø–∏—Ä—É–µ–º —Å–æ–∑–¥–∞–Ω–Ω—ã–π –¢–û–ö–ï–ù. –î–æ–±–∞–≤–ª—è–µ–º –µ–≥–æ –≤ Jenkins credentials: kind - secret text, secret - –Ω–∞—à jenkins-pipeline, id - docker_token, description - docker_token.

–≠—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ, —á—Ç–æ–±—ã jenkins –º–æ–≥ –ø—É—à–∏—Ç—å –Ω–∞—à –æ–±—Ä–∞–∑ –≤ —É–¥–∞–ª–µ–Ω–Ω—ã–π docker hub.
<h3>–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫–ª—é—á–∞ Jenkins –≤ GitHub</h3>

    sudo =u jenkins -i
    ssh-keygen -t ed25519
    cat ~/.ssh/id_ed25519.pub
–ö–æ–ø–∏—Ä—É–µ–º –≤—ã–≤–æ–¥. –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –Ω–∞—à –ø—Ä–æ–µ–∫—Ç –≤ GitHub: https://github.com/ioannsnakej/bookstore/ - settings - deploy keys. –ò –¥–æ–±–∞–≤–ª—è–µ–º –Ω–∞—à –∫–ª—é—á.
<h3>–°–æ–∑–¥–∞–Ω–∏–µ item –≤ Jenkins</h3>
–í –±—Ä–∞—É–∑–µ—Ä–µ –ø–µ—Ä–µ—Ö–æ–¥–∏–º –Ω–∞ https://github.com/ioannsnakej/bookstore/

–ù–∞–∂–∏–º–∞–µ–º "–°–æ–∑–¥–∞—Ç—å item"

–≤–≤–æ–¥–∏–º –∏–º—è- —è –≤—ã–±—Ä–∞–ª bookstore-build

–≤—ã–±–∏—Ä–∞–µ–º —Ç–∏–ø Pipeline

–í –æ—Ç–∫—Ä—ã–≤—à–µ–º—Å—è –æ–∫–Ω–µ –∑–∞–ø–æ–ª–Ω—è–µ–º –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫:

![addpipeline](/lesson_29/screenshots/addpipeline.png)

–£ –ø–æ–ª—è "Credentials" –Ω–∞–∂–∏–º–∞–µ–º "+Add" - "Jenkins":

–ó–∞–ø–æ–ª–Ω—è–µ–º –ø—Ä–∏–º–µ—Ä–Ω–æ —Ç–∞–∫:

![addgithubssh](/lesson_29/screenshots/addgithubssh.png)

![addgithubssh_key](/lesson_29/screenshots/addgithubssh_key.png)

–ø–æ—Å–ª–µ —ç—Ç–∏—Ö –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–π –≤ –ø–æ–ª–µ "Credentials" –≤—ã–±–∏—Ä–∞–µ–º —Å–æ–∑–¥–∞–Ω–Ω–æ–µ "git (github_ssh)" –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º.
<h3>–ó–∞–ø—É—Å–∫ –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞</h3>
–ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –Ω–∞—à—É —Å–±–æ—Ä–∫—É http://localhost:8080/job/bookstore-build/ –∏ –Ω–∞–∂–∏–º–∞–µ–º "–°–æ–±—Ä–∞—Ç—å —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏"

![run](/lesson_29/screenshots/run.png)

–£—Å–ø–µ—Ö:

![done](/lesson_29/screenshots/done.png)

–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ dockerhub —Ç–æ–∂–µ —Å–æ–∑–¥–∞–ª—Å—è - https://hub.docker.com/repository/docker/ivankhodyrev/bookstore/general

–î–æ–±–∞–≤–ª—è—é –≤ stage('Build') —Å–∫—Ä–∏–ø—Ç:

    script {
               sh """
                  curl -s -X POST https://api.telegram.org/bot${env.TG_BOT_TOKEN}/sendMessage \
                  -d chat_id=${env.TG_CHAT_ID} \
                  -d parse_mode=Markdown \
                  -d text="üèÉ–ù–∞—á–∞—Ç–∞ —Å–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ ${env.PRJ_NAME}"
                """
            }
–î–æ–±–∞–≤–ª—è—é –≤ –∫–æ–Ω—Ü–µ Jenkinsfile —Ä–∞–∑–¥–µ–ª post:

     post {
        success {
          script {
            sh """
              curl -s -X POST https://api.telegram.org/bot${env.TG_BOT_TOKEN}/sendMessage \
              -d chat_id=${env.TG_CHAT_ID} \
              -d parse_mode=Markdown \
              -d text="‚úÖSuccess! –ü—Ä–æ–µ–∫—Ç:${env.PRJ_NAME}"
            """
          }
        }
    
        failure {
          script {
            sh """
                  curl -s -X POST https://api.telegram.org/bot${env.TG_BOT_TOKEN}/sendMessage \
                  -d chat_id=${env.TG_CHAT_ID} \
                  -d parse_mode=Markdown \
                  -d text="‚ùåFailed! –ü—Ä–æ–µ–∫—Ç:${env.PRJ_NAME}"
                """
          }
        }
      }
  –ó–∞–ø—É—Å–∫–∞—é –∏ —Å–º–æ—Ç—Ä—é —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ –¢–ì:

  ![notify](/lesson_29/screenshots/notify.png)


